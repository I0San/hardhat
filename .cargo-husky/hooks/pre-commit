#!/bin/sh -x
#
# Intended to be in sync with .github/workflows/hardhat-core-ci.yml's
# test-rethnet-rs

set -e

export RUSTFLAGS=-Dwarnings

if [ -z "${ALCHEMY_URL}" ]; then
  echo WARNING: skipping remote tests because the ALCHEMY_URL environment variable is not defined. Local test results may differ from those in CI.
  REMOTE=,test-disable-remote
else
  REMOTE=
fi

cargo check --workspace --all-features --all-targets
cargo test --workspace --all-targets --features tracing,bench-once${REMOTE}
cargo test --doc --workspace --features tracing
cargo clippy --all -- -D warnings
cargo fmt --all -- --check
